---
title: "Euclidean distance and its projection"
author: "Andrea SÃ¡nchez Tapia"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F)
```

```{r}
library(rJava)
library(raster)
#library(ModelR)
devtools::load_all("../../../modelr_pkg/")
library(dplyr)
```

# Dataset

```{r}
especies <- names(coordenadas)[1]
coord1sp <- coordenadas[[1]]
head(coord1sp)
dim(coord1sp)
ceiling(0.7 * nrow(coord1sp))
set <- sample(1:nrow(coord1sp), size = ceiling(0.7 * nrow(coord1sp)))
train_set <- coord1sp[set,]
test_set <- coord1sp[setdiff(1:nrow(coord1sp),set),]

```

# Fitting and projection datasets


```{r enm1, message = F, eval = T}
fit_data <- raster::stack("./env/cropped_proj.tif")
```

```{r remedy001}

centroide1 <- modleR::euclidean(x = example_vars,
                  occs = train_set[,c(2,3)],
                  algo = "centroid")
centroide2 <- modleR::euclidean(x = fit_data,
                  occs = train_set[,c(2,3)],
                  algo = "centroid")
plot(centroide1)
plot(centroide2)
points(train_set[,c(2,3)])

```

```{r mindist}

mindist1 <- modleR::euclidean(x = example_vars, 
                  occs = train_set[,c(2,3)],
                  algo = "mindist")
mindist2 <- modleR::euclidean(x = fit_data, 
                  occs = train_set[,c(2,3)],
                  algo = "mindist")

plot(mindist1)
points(train_set[,c(2,3)])
plot(mindist2)
points(train_set[,c(2,3)])
```


```{r}
a <- rescale_layer(mindist1)
plot(a)
a>0.8
plot(sort(values(a)))

plot(a > 0.95, main = "dist > 0.95", col = c("white", "green"))
plot(a > 0.99, main = "dist > 0.99", legend = F, add = T, col = c(NA, "red"))
maps::map(,,,add = T)

```


```{r}
setup <- setup_sdmdata(
    species_name = especies[1],
    occurrences = coord1sp[, -1],
    predictors = fit_data,
    models_dir = "./eucl")
```

```{r}
centroid_no_proj <- do_any(species_name = especies[1],
                  predictors = fit_data,
                  write_png = T,
                  algo = "centroid",
                  models_dir = "./eucl")
mindist_no_proj <- do_any(species_name = especies[1],
                  predictors = fit_data,
                  write_png = T,
                  algo = "mindist",
                  models_dir = "./eucl")
```


## Model projection


