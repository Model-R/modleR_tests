---
title: "Testing setupsdmdata in modleR"
author: "Andrea Sánchez-Tapia & Sara Mortara"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

Here we test the function `setup_sdmdata` function and its different parametrization options. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = T)
```

Loading required packages. 

```{r load}
library(rJava)
library(raster)
library(modleR)
#eu estou usando uma cópia local para desenvolvimento
#devtools::load_all("../../ModelR")
#mas o pacote pode ser instalado assim: 
#devtools::install_github("model-r/modelr_pkg", build_vignettes = TRUE, ref = "petropolis")

```

# We use a standard dataset from the package. 

We select only one species from the example data in the package. We separate data from species # 01 into into train (70% of data) and test (30% of data) data sets. 

```{r dataset}
# creating a vector with species names
especies <- unique(coordenadas$sp)
# creating a vector with coordinates from species #1
coord1sp <- dplyr::filter(coordenadas, sp == especies[1])
head(coord1sp)
dim(coord1sp) # 341 records
# fixing seed for reproductibility
set.seed(42)
# creating train (70% of data) and test subsets for species #1 
## sampling 70% of data
set <- sample(1:nrow(coord1sp), size = ceiling(0.7 * nrow(coord1sp)))
## creating train data set
train_set <- coord1sp[set,]
## creating test data set
test_set <- coord1sp[setdiff(1:nrow(coord1sp),set),]
```


Then, we plot train and test data sets with environmental predictors. 

```{r plotdataset}
predictor <- example_vars[[1]]
pts <- SpatialPoints(coord1sp[,c(2,3)])
plot(predictor, legend = F)
points(train_set[,2:3], col = "red", pch = 19)
points(test_set[,2:3], col = "blue", pch = 19)
legend("topright", c("train data set", "test data set"), pch=19, col=c("red", "blue"))
```

# Function arguments

Lets explore different arguments in `setup_sdmdata` function. 

```{r args, echo = F}
args(setup_sdmdata)
```


```{r remedy001}
a <- setup_sdmdata(species_name = especies[1], # species #01
              occurrences = coord1sp[,-1], 
              predictors = example_vars,
              models_dir = "./setupsdmdata/setupsdmdatam",
              real_absences = NULL,
              buffer_type = NULL,
              clean_dupl = T,
              clean_nas = T,
              seed = 512)
```

Exploring the output from `setup_sdmdata`. 

```{r remedy002}
head(a)
```

```{r remedy003}
knitr::include_graphics("./setupsdmdata/setupsdmdatam/Eugenia florida DC./present/partitions/sdmdata_Eugenia florida DC..png")
```

#### buffer mean

```{r remedy0031}

b <- setup_sdmdata(species_name = especies[1],
              occurrences = coord1sp[,-1],
              predictors = example_vars,
              models_dir = "./setupsdmdata/setupsdmdatan",
              real_absences = NULL,
              buffer_type = "mean",
              clean_dupl = T,
              clean_nas = T,
              seed = 512)
```


```{r remedy004}
head(b)
```

```{r remedy0061}
knitr::include_graphics("./setupsdmdata/setupsdmdatan/Eugenia florida DC./present/partitions/sdmdata_Eugenia florida DC..png")
```


#buffer median

```{r remedy005}
c <- setup_sdmdata(species_name = especies[1],
              occurrences = coord1sp[,-1],
              predictors = example_vars,
              models_dir = "./setupsdmdata/setupsdmdatap",
              real_absences = NULL,
              buffer_type = "median",
              clean_dupl = T,
              clean_nas = T,
              seed = 512)
```


```{r remedy006}
head(c)
```

```{r remedy009}
knitr::include_graphics("./setupsdmdata/setupsdmdatap/Eugenia florida DC./present/partitions/sdmdata_Eugenia florida DC..png")
```

#buffer max

```{r remedy0051}
d <- setup_sdmdata(species_name = especies[1],
              occurrences = coord1sp[,-1],
              predictors = example_vars,
              models_dir = "./setupsdmdata/setupsdmdatax",
              real_absences = NULL,
              buffer_type = "max",
              clean_dupl = T,
              clean_nas = T,
              seed = 512)
```


```{r remedy0062}
head(d)
```

```{r remedy0092}
knitr::include_graphics("./setupsdmdata/setupsdmdatax/Eugenia florida DC./present/partitions/sdmdata_Eugenia florida DC..png")
```

#buffer dist

```{r remedy00512}
e <- setup_sdmdata(species_name = especies[1],
              occurrences = coord1sp[,-1],
              predictors = example_vars,
              models_dir = "./setupsdmdata/setupsdmdataxd",
              real_absences = NULL,
              buffer_type = "distance",
              dist_buf = 4,
              clean_dupl = T,
              clean_nas = T,
              seed = 512)
```


```{r remedy00622}
head(e)
```

```{r remedy00922}
knitr::include_graphics("./setupsdmdata/setupsdmdataxd/Eugenia florida DC./present/partitions/sdmdata_Eugenia florida DC..png")
```
